---
import '../styles/global.css';
---

<header class="bg-transparent fixed w-full top-0 z-50 font-bold font-[Montserrat] transition-colors duration-300" id="main-header">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
    <div class="flex items-center justify-between h-20 space-x-10">
      <!-- Logo -->
      <div class="flex items-center">
        <div class="flex-shrink-0 flex items-center">
          <div class="mr-3">
            <a href="/">
              <img src="/src/assets/LOGO.png" alt="Safeguard Laboratories Logo" class="w-60 object-contain pt-6">
            </a>
          </div>
        </div>
      </div>

      <!-- Navigation -->
    <nav class="hidden xl:block">
      <div class="flex items-baseline space-x-13 lg:gap-5">
        <!-- Categorías principales -->
        <a href="#home" class="header-nav-link text-black hover:text-[#015c9f] text-sm font-medium uppercase tracking-wide relative overflow-hidden ">
          <span class="relative z-10 text-xl">HOME</span>
          <div class="nav-underline absolute bottom-0 left-0 w-0 h-0.5 bg-[#015c9f] transition-all duration-300"></div>
        </a>
        <a href="#manufacturing" class="header-nav-link text-black hover:text-[#015c9f] text-sm font-medium uppercase tracking-wide relative overflow-hidden ">
          <span class="relative z-10 text-xl">MANUFACTURING</span>
          <div class="nav-underline absolute bottom-0 left-0 w-0 h-0.5 bg-[#015c9f] transition-all duration-300"></div>
        </a>
        <a href="#why-choose-us" class="header-nav-link text-black hover:text-[#015c9f] text-sm font-medium uppercase tracking-wide relative overflow-hidden ">
          <span class="relative z-10 text-xl">WHY CHOOSE US</span>
          <div class="nav-underline absolute bottom-0 left-0 w-0 h-0.5 bg-[#015c9f] transition-all duration-300"></div>
        </a>
        <!-- Dropdown para subcategorías -->
        <div class="relative" id="desktop-more-group">
          <button id="desktop-more-btn" type="button" class="header-nav-link flex items-center text-black hover:text-[#015c9f] text-sm font-medium uppercase tracking-wide relative overflow-hidden focus:outline-none">
            <span class="relative z-10 text-xl">MORE</span>
            <svg class="ml-1 w-4 h-4 transition-transform" id="desktop-more-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div id="desktop-more-menu" class="absolute left-0 mt-2 w-48 bg-white rounded shadow-lg opacity-0 pointer-events-none transition-opacity duration-200 z-50">
            <a href="#capabilities" class="block px-4 py-2 text-black hover:bg-gray-100">CAPABILITIES</a>
            <a href="#process" class="block px-4 py-2 text-black hover:bg-gray-100">PROCESS</a>
            <a href="#facility" class="block px-4 py-2 text-black hover:bg-gray-100">FACILITY</a>
            <a href="#project" class="block px-4 py-2 text-black hover:bg-gray-100">PROJECT</a>
            <a href="#contact" class="block px-4 py-2 text-black hover:bg-gray-100">CONTACT</a>
            <a href="#map" class="block px-4 py-2 text-black hover:bg-gray-100">MAP</a>
          </div>
        </div>
      </div>
    </nav>

      <!-- Mobile menu button -->
      <div class="xl:hidden">
        <button id="mobile-menu-button" type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-700 hover:text-blue-600 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500">
          <span class="sr-only ">Open main menu</span>
          <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
            <path class="hamburger-line" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            <path class="close-line hidden" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile menu -->
  <div id="mobile-menu" class="xl:hidden hidden">
    <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
      <a href="#home" class="mobile-nav-link block px-3 py-2 text-base font-medium text-black hover:text-blue-600 hover:bg-gray-50 uppercase tracking-wide ">
        HOME
      </a>
      <a href="#manufacturing" class="mobile-nav-link block px-3 py-2 text-base font-medium text-black hover:text-blue-600 hover:bg-gray-50 uppercase tracking-wide ">
        MANUFACTURING
      </a>
      <a href="#why-choose-us" class="mobile-nav-link block px-3 py-2 text-base font-medium text-black hover:text-blue-600 hover:bg-gray-50 uppercase tracking-wide ">
        WHY CHOOSE US
      </a>
      <!-- Botón para mostrar subcategorías -->
      <button id="mobile-more-btn" type="button" class="w-full flex items-center justify-between px-3 py-2 text-base font-medium text-black hover:text-blue-600 hover:bg-gray-50 uppercase tracking-wide focus:outline-none">
        MORE
        <svg id="mobile-more-icon" class="w-5 h-5 ml-2 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </button>
      <div id="mobile-more-menu" class="hidden flex-col pl-4">
        <a href="#capabilities" class="mobile-nav-link block px-3 py-2 text-base font-medium text-black hover:text-blue-600 hover:bg-gray-50 uppercase tracking-wide">CAPABILITIES</a>
        <a href="#process" class="mobile-nav-link block px-3 py-2 text-base font-medium text-black hover:text-blue-600 hover:bg-gray-50 uppercase tracking-wide">PROCESS</a>
        <a href="#facility" class="mobile-nav-link block px-3 py-2 text-base font-medium text-black hover:text-blue-600 hover:bg-gray-50 uppercase tracking-wide">FACILITY</a>
        <a href="#project" class="mobile-nav-link block px-3 py-2 text-base font-medium text-black hover:text-blue-600 hover:bg-gray-50 uppercase tracking-wide">PROJECT</a>
        <a href="#contact" class="mobile-nav-link block px-3 py-2 text-base font-medium text-black hover:text-blue-600 hover:bg-gray-50 uppercase tracking-wide">CONTACT</a>
        <a href="#map" class="mobile-nav-link block px-3 py-2 text-base font-medium text-black hover:text-blue-600 hover:bg-gray-50 uppercase tracking-wide">MAP</a>
      </div>
    </div>
  </div>
</header>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  // Animaciones de entrada del header
  const headerTl = gsap.timeline();

  // Animación de los enlaces de navegación
  headerTl.from('.header-nav-link', {
    duration: 0.5,
    y: -20,
    opacity: 0,
    stagger: 0.1,
    ease: 'power2.out'
  }, '-=0.3');

  // Animación del botón móvil
  headerTl.from('#mobile-menu-button', {
    duration: 0.5,
    scale: 0,
    opacity: 0,
    ease: 'back.out(1.7)'
  }, '-=0.4');

  // Animaciones de hover para los enlaces de navegación
  document.querySelectorAll('.header-nav-link').forEach(link => {
    const underline = link.querySelector('.nav-underline');
    
    link.addEventListener('mouseenter', () => {
      gsap.to(underline, {
        duration: 0.1,
        width: '100%',
        ease: 'power2.out'
      });
    });

    link.addEventListener('mouseleave', () => {
      gsap.to(underline, {
        duration: 0.1,
        width: '0%',
        ease: 'power2.out'
      });
    });
  });

  // Animación de scroll para el header
  const header = document.getElementById('main-header');
  ScrollTrigger.create({
    trigger: 'body',
    start: 'top -10',
    end: 'bottom bottom',
    onEnter: () => {
      gsap.to(header, {
        duration: 0.3,
        backgroundColor: 'rgba(255,255,255,1)',
        backdropFilter: 'blur(10px)',
        ease: 'power2.out'
      });
    },
    onLeaveBack: () => {
      gsap.to(header, {
        duration: 0.3,
        backgroundColor: 'rgba(255,255,255,0)',
        backdropFilter: 'blur(0px)',
        ease: 'power2.out'
      });
    }
  });

  // Funcionalidad del menú móvil
  const mobileButton = document.querySelector('#mobile-menu-button');
  const mobileMenu = document.querySelector('#mobile-menu');
  const hamburgerLine = document.querySelector('.hamburger-line');
  const closeLine = document.querySelector('.close-line');
  let isMobileMenuOpen = false;

  if (mobileButton && mobileMenu && hamburgerLine && closeLine) {
    mobileButton.addEventListener('click', () => {
      isMobileMenuOpen = !isMobileMenuOpen;
      
      if (isMobileMenuOpen) {
        // Mostrar menú
        mobileMenu.classList.remove('hidden');
        hamburgerLine.classList.add('hidden');
        closeLine.classList.remove('hidden');
        
        // Animación de entrada
        gsap.fromTo(mobileMenu, 
          { opacity: 0, y: -20 },
          { duration: 0.3, opacity: 1, y: 0, ease: 'power2.out' }
        );
        
        // Animación de los enlaces
        gsap.fromTo('.mobile-nav-link', 
          { opacity: 0, x: -20 },
          { duration: 0.3, opacity: 1, x: 0, stagger: 0.1, ease: 'power2.out' }
        );
      } else {
        // Ocultar menú
        hamburgerLine.classList.remove('hidden');
        closeLine.classList.add('hidden');
        
        gsap.to(mobileMenu, {
          duration: 0.3,
          opacity: 0,
          y: -20,
          ease: 'power2.out',
          onComplete: () => {
            mobileMenu.classList.add('hidden');
          }
        });
      }
      
      // Animación del botón
      gsap.to(mobileButton, {
        duration: 0.2,
        scale: 0.95,
        ease: 'power2.out',
        onComplete: () => {
          gsap.to(mobileButton, {
            duration: 0.2,
            scale: 1,
            ease: 'back.out(1.7)'
          });
        }
      });
    });

    // Cerrar menú al hacer click en un enlace
    document.querySelectorAll('.mobile-nav-link').forEach(link => {
      link.addEventListener('click', () => {
        if (isMobileMenuOpen) {
          (mobileButton as HTMLButtonElement).click(); // Simular click del botón para cerrar
        }
      });
    });
  }

  // Lógica para el menú "MORE" en mobile
  const mobileMoreBtn = document.getElementById('mobile-more-btn');
  const mobileMoreMenu = document.getElementById('mobile-more-menu');
  const mobileMoreIcon = document.getElementById('mobile-more-icon');
  let isMoreOpen = false;

  if (mobileMoreBtn && mobileMoreMenu && mobileMoreIcon) {
    mobileMoreBtn.addEventListener('click', () => {
      isMoreOpen = !isMoreOpen;
      if (isMoreOpen) {
        mobileMoreMenu.classList.remove('hidden');
        mobileMoreIcon.classList.add('rotate-180');
      } else {
        mobileMoreMenu.classList.add('hidden');
        mobileMoreIcon.classList.remove('rotate-180');
      }
    });
  }

  // Dropdown "MORE" para desktop (abre/cierra con click y cierra al hacer click fuera)
  const desktopMoreBtn = document.getElementById('desktop-more-btn');
  const desktopMoreMenu = document.getElementById('desktop-more-menu');
  const desktopMoreIcon = document.getElementById('desktop-more-icon');
  const desktopMoreGroup = document.getElementById('desktop-more-group');
  let isDesktopMoreOpen = false;

  if (desktopMoreBtn && desktopMoreMenu && desktopMoreIcon && desktopMoreGroup) {
    desktopMoreBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      isDesktopMoreOpen = !isDesktopMoreOpen;
      if (isDesktopMoreOpen) {
        desktopMoreMenu.classList.remove('opacity-0', 'pointer-events-none');
        desktopMoreMenu.classList.add('opacity-100', 'pointer-events-auto');
        desktopMoreIcon.classList.add('rotate-180');
      } else {
        desktopMoreMenu.classList.add('opacity-0', 'pointer-events-none');
        desktopMoreMenu.classList.remove('opacity-100', 'pointer-events-auto');
        desktopMoreIcon.classList.remove('rotate-180');
      }
    });

    // Cerrar al hacer click fuera
    document.addEventListener('click', (e) => {
      if (isDesktopMoreOpen && !desktopMoreGroup.contains(e.target as Node)) {
        isDesktopMoreOpen = false;
        desktopMoreMenu.classList.add('opacity-0', 'pointer-events-none');
        desktopMoreMenu.classList.remove('opacity-100', 'pointer-events-auto');
        desktopMoreIcon.classList.remove('rotate-180');
      }
    });
  }

  // Smooth scroll para enlaces internos del header y menú mobile
  document.querySelectorAll('a[href^="#"]').forEach(link => {
    link.addEventListener('click', function(e: Event) {
      const targetId = (e.currentTarget as HTMLAnchorElement).getAttribute('href');
      if (targetId && targetId.length > 1 && document.querySelector(targetId)) {
        e.preventDefault();
        const target = document.querySelector(targetId);
        if (target) {
          window.scrollTo({
            top: target.getBoundingClientRect().top + window.scrollY - 80, // Ajusta el offset si tienes header fijo
            behavior: 'smooth'
          });
        }
      }
    });
  });
</script>
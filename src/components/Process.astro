---
import '../styles/global.css';
---

<section
  id="process"
  class="relative overflow-hidden min-h-screen flex items-center justify-center"
>
  <!-- Video de fondo con configuración mejorada -->
  <div class="absolute inset-0 w-full h-full">
    <video
      id="background-video"
      class="absolute top-0 left-0 w-full h-full object-cover video-darkened"
      autoplay
      muted
      loop
      playsinline
      preload="auto"
      poster="/10_fondo.png"
      style="z-index: 1; display: block;"
     
      onerror="console.error('Video error occurred');"
    >
      <source src="./Video_fondo.mp4" type="video/mp4">
      <source src="/Video_fondo.mp4" type="video/mp4">
      <source src="Video_fondo.mp4" type="video/mp4">
      
      <img src="/10_fondo.png" alt="Background" style="width: 100%; height: 100%; object-fit: cover;">
    </video>
    
    
    <div 
      id="fallback-bg"
      class="absolute inset-0 w-full h-full bg-cover bg-center bg-no-repeat"
      style="background-image: url('/10_fondo.png'); z-index: 1; display: none;"
    ></div>
  </div>

  <!-- Contenido principal -->
  <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 w-full py-8 sm:py-12 lg:py-16">
    
    
    <div class="text-center mb-8 sm:mb-12 lg:mb-16">
<p class="process-title-0 process-subtitle text-white mb-3 tracking-wide" style="font-size: 48px; font-family: 'Antonio Light', 'Antonio', sans-serif; font-weight: 300; margin-bottom: -0.1em;">
        FROM CONCEPT TO COMPLETION:
      </p>
      <h1 class="process-main-title text-white font-light" style="font-family: 'Antonio', sans-serif; line-height: 1;">
        <span class="process-title-1 block" style="font-size: 72px; margin-bottom: 0.1em; margin-top: 0.05em; font-weight: 300;">THE SAFEGUARD</span>
        <span class="process-title-2 block" style="font-size: 120px; margin-top: 0.09em; ">PROCESS</span>
      </h1>
<p class="process-description text-white mt-10 max-w-4xl mx-auto font-montserrat font-normal" style="font-size: 20px; line-height: 1;">
        <b>Our process is engineered to reduce friction and accelerate results</b><br class="hidden sm:block">
        Whether you're launching a new product or scaling an existing one,<br class="hidden sm:block">
        we guide you through every step with precision and transparency
      </p>
    </div>

    <!-- Layout de 2 columnas y 3 filas, con alineación y líneas según lo solicitado -->
    <div class="max-w-6xl grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6 lg:gap-8 w-full items-start">
      
      <div class="process-section pb-6 w-full lg:col-span-1" data-section="discovery">
        <div class="process-header flex items-center gap-4 cursor-pointer transition-all duration-300">
          <div class="flex flex-col w-full">
            <h3 class="process-section-title text-white text-lg sm:text-xl md:text-[1.5rem] font-medium transition-all duration-500 whitespace-nowrap tracking-tight max-w-full flex justify-start pl-2 lg:pl-6 xl:pl-10" style="font-family: 'Antonio', sans-serif; text-transform: uppercase; letter-spacing: 0.01em; font-size: 1.5rem;">
              <span class="block text-[1.15rem] sm:text-[1.35rem] md:text-[1.6rem] lg:text-[1.85rem] xl:text-[2.05rem] 2xl:text-[2.2rem]">DISCOVERY CONSULTATION</span>
            </h3>
            <div class="process-content overflow-hidden transition-all duration-500 max-h-0">
              <div class="pt-4 pl-2 lg:pl-6 xl:pl-10">
                <p class="text-white text-sm sm:text-base font-montserrat font-normal leading-relaxed opacity-90">
                  We listen, ask the right questions, and understand your vision and goals
                </p>
              </div>
            </div>
          </div>
          <div class="process-toggle text-white text-4xl font-light transition-transform duration-300 flex items-center cursor-pointer">+</div>
        </div>
      </div>
      
      <div class="process-section pb-6 w-full lg:col-span-1" data-section="qa-rd">
        <div class="process-header flex items-center gap-4 cursor-pointer transition-all duration-300">
          <div class="flex flex-col w-full">
            <h3 class="process-section-title text-white text-lg sm:text-xl md:text-[1.5rem] font-medium transition-all duration-500 whitespace-nowrap tracking-tight max-w-full flex justify-start pl-2 lg:pl-6 xl:pl-10" style="font-family: 'Antonio', sans-serif; text-transform: uppercase; letter-spacing: 0.01em; font-size: 1.5rem;">
              <span class="block text-[1.15rem] sm:text-[1.35rem] md:text-[1.6rem] lg:text-[1.85rem] xl:text-[2.05rem] 2xl:text-[2.2rem]">QA AND R&D</span>
            </h3>
            <div class="process-content overflow-hidden transition-all duration-500 max-h-0">
              <div class="pt-4 pl-2 lg:pl-6 xl:pl-10">
                <p class="text-white text-sm sm:text-base font-montserrat font-normal leading-relaxed opacity-90">
                  Every run is tested for safety, performance, and full regulatory alignment
                </p>
              </div>
            </div>
          </div>
          <div class="process-toggle text-white text-4xl font-light transition-transform duration-300 flex items-center cursor-pointer">+</div>
        </div>
      </div>
      
      <div class="w-full lg:col-span-2"><div class="border-b border-white border-opacity-30 w-full"></div></div>
      
      <div class="process-section pb-6 w-full lg:col-span-1" data-section="formulation">
        <div class="process-header flex items-center gap-4 cursor-pointer transition-all duration-300">
          <div class="flex flex-col w-full">
            <h3 class="process-section-title text-white text-lg sm:text-xl md:text-[1.5rem] font-medium transition-all duration-500 whitespace-nowrap tracking-tight max-w-full flex justify-start pl-2 lg:pl-6 xl:pl-10" style="font-family: 'Antonio', sans-serif; text-transform: uppercase; letter-spacing: 0.01em; font-size: 1.5rem;">
              <span class="block text-[1.15rem] sm:text-[1.35rem] md:text-[1.6rem] lg:text-[1.85rem] xl:text-[2.05rem] 2xl:text-[2.2rem]">FORMULATION & TESTING</span>
            </h3>
            <div class="process-content overflow-hidden transition-all duration-500 max-h-0">
              <div class="pt-4 pl-2 lg:pl-6 xl:pl-10">
                <p class="text-white text-sm sm:text-base font-montserrat font-normal leading-relaxed opacity-90">
                  Our in-house chemists develop and validate your product in our lab
                </p>
              </div>
            </div>
          </div>
          <div class="process-toggle text-white text-4xl font-light transition-transform duration-300 flex items-center cursor-pointer">+</div>
        </div>
      </div>
      
      <div class="process-section pb-6 w-full lg:col-span-1" data-section="packaging">
        <div class="process-header flex items-center gap-4 cursor-pointer transition-all duration-300">
          <div class="flex flex-col w-full">
            <h3 class="process-section-title text-white text-lg sm:text-xl md:text-[1.5rem] font-medium transition-all duration-500 whitespace-nowrap tracking-tight max-w-full flex justify-start pl-2 lg:pl-6 xl:pl-10" style="font-family: 'Antonio', sans-serif; text-transform: uppercase; letter-spacing: 0.01em; font-size: 1.5rem;">
              <span class="block text-[1.15rem] sm:text-[1.35rem] md:text-[1.6rem] lg:text-[1.85rem] xl:text-[2.05rem] 2xl:text-[2.2rem]">PACKAGING & BRANDING</span>
            </h3>
            <div class="process-content overflow-hidden transition-all duration-500 max-h-0">
              <div class="pt-4 pl-2 lg:pl-6 xl:pl-10">
                <p class="text-white text-sm sm:text-base font-montserrat font-normal leading-relaxed opacity-90">
                  We finalize your product with compliant, high-impact packaging and labeling
                </p>
              </div>
            </div>
          </div>
          <div class="process-toggle text-white text-4xl font-light transition-transform duration-300 flex items-center cursor-pointer">+</div>
        </div>
      </div>
      
      <div class="w-full lg:col-span-2"><div class="border-b border-white border-opacity-30 w-full"></div></div>
      
      <div class="process-section pb-6 w-full lg:col-span-1" data-section="blending">
        <div class="process-header flex items-center gap-4 cursor-pointer transition-all duration-300">
          <div class="flex flex-col w-full">
            <h3 class="process-section-title text-white text-lg sm:text-xl md:text-[1.5rem] font-medium transition-all duration-500 whitespace-nowrap tracking-tight max-w-full flex justify-start pl-2 lg:pl-6 xl:pl-10" style="font-family: 'Antonio', sans-serif; text-transform: uppercase; letter-spacing: 0.01em; font-size: 1.5rem;">
              <span class="block text-[1.15rem] sm:text-[1.35rem] md:text-[1.6rem] lg:text-[1.85rem] xl:text-[2.05rem] 2xl:text-[2.2rem]">BLENDING & FILLING</span>
            </h3>
            <div class="process-content overflow-hidden transition-all duration-500 max-h-0">
              <div class="pt-4 pl-2 lg:pl-6 xl:pl-10">
                <p class="text-white text-sm sm:text-base font-montserrat font-normal leading-relaxed opacity-90">
                  We handle batching, precision blending, and scalable filling: from 1mL to 1 gallon
                </p>
              </div>
            </div>
          </div>
          <div class="process-toggle text-white text-4xl font-light transition-transform duration-300 flex items-center cursor-pointer">+</div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .process-section:hover .process-section-title {
    color: rgba(255, 255, 255, 1) !important;
  }

  .process-section:hover .border-white {
    border-color: rgba(255, 255, 255, 0.6) !important;
  }

  .process-section.active .process-toggle {
    transform: rotate(45deg);
  }

  .process-section.active .process-section-title {
    transform: scale(1.05);
    font-weight: 700 !important;
    color: rgba(255, 255, 255, 1) !important;
  }

  .process-section.active .process-content {
    max-height: 300px !important;
  }

  .process-section.active .border-white {
    border-color: rgba(255, 255, 255, 0.8) !important;
  }
  
  /* Filtro aplicado directamente al video */
  .video-darkened {
    filter: brightness(0.5) contrast(1.1) !important;
    -webkit-filter: brightness(0.5) contrast(1.1) !important;
  }
  
  /* Asegurar que el video se vea */
  #background-video {
    min-width: 100% !important;
    min-height: 100% !important;
    width: auto !important;
    height: auto !important;
    position: absolute !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    z-index: 1 !important;
  }
  
  /* Contenido principal */
  .relative.z-10 {
    z-index: 10 !important;
    position: relative !important;
  }
 
  @media (max-width: 600px) {
    .process-title-0 { font-size: 1.2rem !important; letter-spacing: 0.01em !important; }
    .process-title-1 { font-size: 2.1rem !important; letter-spacing: -0.04em !important; }
    .process-title-2 { font-size: 2.7rem !important; letter-spacing: 0.1em !important; }
    .process-description { font-size: 1rem !important; }
    .process-section-title { font-size: 1rem !important; }
    .process-toggle { font-size: 2rem !important; }
  }
  @media (min-width: 601px) and (max-width: 1024px) {
    .process-title-0 { font-size: 1.7rem !important; letter-spacing: -0.05em !important; }
    .process-title-1 { font-size: 2.8rem !important; letter-spacing: -0.03em !important; }
    .process-title-2 { font-size: 3.8rem !important; letter-spacing: 0.06em !important; }
    .process-description { font-size: 1.1rem !important; }
    .process-section-title { font-size: 1.2rem !important; }
    .process-toggle { font-size: 2.5rem !important; }
  }
  @media (min-width: 1025px) {
    .process-title-0 { font-size: 44px !important; letter-spacing: -0.04em !important; }
    .process-title-1 { font-size: 72px !important; letter-spacing: 0.04em !important; }
    .process-title-2 { font-size: 122px !important; letter-spacing: 0.07em !important; }
    .process-description { font-size: 20px !important; }
    .process-section-title { font-size: 1.5rem !important; }
    .process-toggle { font-size: 2.7rem !important; }
  }
</style>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  document.addEventListener('DOMContentLoaded', () => {
    // Manejo agresivo del video
    const video = document.getElementById('background-video');
    const fallback = document.getElementById('fallback-bg');

    // Animaciones GSAP con ScrollTrigger para que se activen cada vez que la sección entra al viewport
    gsap.timeline({
      scrollTrigger: {
        trigger: '#process', // id correcto de la sección
        start: 'top 80%',
        end: 'bottom 20%',
        toggleActions: 'play none none reset', // Reproduce al entrar, resetea al salir
        markers: false // Puedes poner true para debug
      }
    })
    .from('.process-subtitle', {
      y: 30,
      opacity: 0,
      duration: 0.8,
      ease: 'power2.out'
    })
    .from('.process-main-title', {
      y: 50,
      opacity: 0,
      duration: 1,
      ease: 'power2.out'
    }, '-=0.5')
    .from('.process-description', {
      y: 30,
      opacity: 0,
      duration: 0.8,
      ease: 'power2.out'
    }, '-=0.6')
    .from('.process-section', {
      y: 30,
      opacity: 0,
      duration: 0.6,
      stagger: 0.1,
      ease: 'power2.out'
    }, '-=0.4');

    // Funcionalidad de toggle para las secciones (independiente)
    document.querySelectorAll('.process-section').forEach(section => {
      const header = section.querySelector('.process-header');
      const content = section.querySelector('.process-content');
      const toggle = section.querySelector('.process-toggle');
      const title = section.querySelector('.process-section-title');

      header?.addEventListener('click', () => {
        const isActive = section.classList.contains('active');
        const textContent = content.querySelector('p');
        if (isActive) {
          // Cerrar sección - cambiar de − a +
          section.classList.remove('active');
          if (toggle) toggle.textContent = '+';
          gsap.to(content, {
            maxHeight: 0,
            duration: 0.7,
            ease: 'power4.inOut',
            delay: 0.05
          });
          if (textContent) {
            gsap.to(textContent, {
              autoAlpha: 0,
              y: 30,
              duration: 0.55,
              ease: 'power4.in',
              delay: 0.05
            });
          }
          gsap.to(title, {
            scale: 1,
            fontWeight: 500,
            duration: 0.3,
            ease: 'power2.out'
          });
        } else {
          // Abrir sección actual - cambiar de + a −
          section.classList.add('active');
          if (toggle) toggle.textContent = '−';
          gsap.to(content, {
            maxHeight: 'auto',
            duration: 0.7,
            ease: 'power4.inOut',
            delay: 0.05
          });
          if (textContent) {
            gsap.fromTo(textContent,
              {autoAlpha: 0, y: 30},
              {autoAlpha: 1, y: 0, duration: 0.8, ease: 'power4.out', delay: 0.1}
            );
          }
          gsap.to(title, {
            scale: 1.05,
            fontWeight: 700,
            duration: 0.3,
            ease: 'power2.out'
          });
        }
      });
    });
  });
</script>
